---
output: github_document

  
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# CarefullyCausal

<!-- badges: start -->
<!-- badges: end -->


The goal of CarefullyCausal is to provide the user a practical guide when doing causal analyses. Particularly, CarefullyCausal provides the user the estimand, a table of causal estimates, a discussion on the causal assumptions, relevant diagnostics and interpretations/explanations. The key aspects of a causal analyses are printed and discussed in detail to help the user in evaluating whether the estimated effects can be interpreted as being causal. Currently, CarefullyCausal can be used in a setting with a fixed-exposure, meaning that the exposure does not vary over time.\

Some key features:\

* **Setting**: Fixed-exposure
* **Outcome of interest**: can be dichotomous or continuous
* **Exposure of interest**: can be dichotomous, multi-value (max 4 levels) or continuous
* **Effect measures**: can be in log(odds), risk ratio or odds ratio



## Installation

You can install the development version of CarefullyCausal as follows:
```{r install, eval=FALSE}
# To download R packages from Github or other sources we need the "devtools" package
install.packages("devtools")
library("devtools")

# Now we can download the CarefullyCausal package
install_github("mauricekorf/CarefullyCausal")
library(CarefullyCausal)
```


## Example

To develop some intuition with the CarefullyCausal function and to highlight some important features, an example is step-by-step illustrated using the NHEFS^[National Health and Nutrition Examination Survey Data I Epidemiologic Follow-up Study, https://wwwn.cdc.gov/nchs/nhanes/nhefs/] data set.


### Research Question

Suppose that we are interested in the causal relation between quitting smoking and weight change (in Kilograms). Specifically,we would like to know the effect of quitting smoking on someone's weight change. In order to evaluate this causal relation, we assume that there are some important confounders we need to adjust for, which includes:\
sex, race, age, education level, smoke intensity (number of cigarettes per day), how long someone has been smoking ( in years), start weight (in Kilograms), how much someone exercises (**0:** much exercise, **1:** moderate exercise, **2:** no exercise) and how active a person is on a usual day (**0:** very active, **1:** moderately active, **2:** inactive)

<br>
Given that we assume that these are the only confounders and that no collider bias or selection bias is induced, we would obtain the following simple Directed Acyclic Graph (DAG):
<p align='center'>
```{r RQ, eval=TRUE, echo=FALSE, warning=FALSE, message=FALSE, fig.width=10, fig.height=10, out.width='60%', fig.align='center'}
library(ggdag)
library(ggplot2)
library(causaldata)
library(kableExtra)

# Load in the data, we will use the complete cases variant
df = nhefs_complete

# Make the coordination of the different nodes
# https://lfoswald.github.io/2021-spring-stats2/materials/session-3/03-online-tutorial/
coord_dag <- list(
  x = c(qsmk = 0, wt82_71 = 3, sex = 1.5, race = 1.5, education = 1.5, smokeintensity = 1.5, smokeyrs = 1.5, wt71 = 1.5, exercise = 1.5, active = 1.5, age = 1.5 ),
  y = c(qsmk = 0, wt82_71 = 0, sex = 1, race = 1.5, education = 2, smokeintensity = 2.5, smokeyrs = -1, wt71 = -1.5, exercise = -2, active = -2.5, age = -3)
)
# Create the DAG structure
our_dag <- ggdag::dagify(wt82_71 ~ qsmk,
                         wt82_71 ~ sex + race + education + smokeintensity + smokeyrs + wt71 + exercise + active + age,
                         qsmk ~ sex + race + education + smokeintensity + smokeyrs + wt71 +exercise + active + age,
                         coords = coord_dag,
                         labels = c("wt82_71" = "Weight\n change",
                                    "qsmk" = "Quit smoke",
                                    "race" = "race",
                                    "sex" = "sex",
                                    "education" = "education",
                                    "smokeintensity" = "number cigarettes",
                                    "smokeyrs" = "years smoking",
                                    "wt71" = "start weight",
                                    "exercise" = "exercise",
                                    "active" = "active",
                                    "age" = "age"))
# Plot the DAG
ggdag(our_dag, text = FALSE, use_labels = "label") + theme_void()

```
</p>
<center>
<i>Figure 1: </i>The selected variables are for illustration purposes only. The DAG shows by no means the true causal structure
</center>




### Data

In order to answer our research question, we will use a subset of the NHEFS data set from Hernán MA & Robins JM (2020) in the *Causal inference: What if* book^[Hernán MA, Robins JM (2020). Causal Inference: What If. Boca Raton: Chapman & Hall/CRC,https://www.hsph.harvard.edu/miguel-hernan/causal-inference-book/]. To conveniently import this data set we will use the package *causaldata*.

```{r download data, eval=FALSE}
# Download the required package, containing various (causal) data sets
install.packages("causaldata")
library(causaldata)

# Load in the data, we will use the complete cases variant
df = nhefs_complete
```
<br>


We will now select the variables that we deemed to be relevant, as shown in Figure 1 (DAG). We show the first six rows of the data set below, to get an idea of the data set.
```{r select variables data, eval=TRUE}
# Select variables
df = nhefs_complete[,c("wt82_71","qsmk","race","sex","education","smokeintensity", "smokeyrs","wt71","exercise","active", "age")]
```

```{r show variables data, eval=TRUE, echo=FALSE}
# Get an idea of the data (first 6 rows)
knitr::kable(head(df))
```
<br>

To further inspect the variable coding and the corresponding definition we will create a table including the class of the variable.
<center>
```{r explain variables data, eval=TRUE, echo=FALSE, fig.align='center', out.width="60%"}
# Get an idea how the variables are coded and what type it is
variables <- setNames(stack(sapply(df, class))[2:1], c('variable', 'class'))
description <- c("The weight change between 1971 and 1982 in Kg ",
                 "Quit smoking, 1: yes, 0: no",
                 "1: black or other, 0: white, ",
                 "1: female, 0: male",
                 "1: 8th grade, 2: HS dropout, 3: HS, 4: college dropout, 5: college or higher",
                 "Number of cigarettes smoked per day in 1971",
                 "Years of smoking",
                 "Start weight (Kg) in 1971",
                 "In recreation in 1971 how mu h exercising, 0: much, 1: moderate, 2: little or none",
                 "On usual day how active in 1971, 0: very active, 1: moderately active, 2: inactive",
                 "Age in 1971")

variables = cbind(variables,description)
knitr::kable(variables)
```
</center>


